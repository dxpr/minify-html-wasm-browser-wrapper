<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebAssembly Explained</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
      .hero {
        background-color: #f8f9fa;
        padding: 4rem 2rem;
        margin-bottom: 2rem;
        border-radius: .3rem;
      }
    </style>
  </head>
  <body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="#">WASM Explained</a>
      </div>
    </nav>

    <div class="container">
      <div class="hero">
        <h1 class="display-4">WebAssembly (WASM)</h1>
        <p class="lead">The future of high-performance applications on the web.</p>
        <hr class="my-4">
        <p>A binary instruction format for a stack-based virtual machine. WASM is designed as a portable compilation target for programming languages, enabling deployment on the web for client and server applications.</p>
      </div>

      <div class="row">
        <div class="col-md-8">
          <h2>What is WebAssembly?</h2>
          <p>
            WebAssembly (abbreviated Wasm) is an open standard that defines a portable binary-code format for executable programs, and a corresponding textual assembly language, as well as interfaces for facilitating interactions between such programs and their host environment.
          </p>
          <p>
            The main goal of WebAssembly is to enable high-performance applications on web pages, but its format is designed to be executed and integrated in other environments as well, including standalone ones.
          </p>

          <h2 class="mt-4">Running Powerful Software in the Browser</h2>
          <p>
            Before WebAssembly, JavaScript was the only language that could run natively in browsers. While JavaScript is powerful, it wasn't designed for computationally intensive tasks like 3D games, computer-aided design, video editing, or scientific simulations.
          </p>
          <p>
            Wasm provides a way to run code written in other languages, such as C, C++, and Rust, on the web at near-native speed. This opens the door for running powerful software directly in the browser, something that was previously impractical. Developers can now compile their existing C/C++ applications into a Wasm module and run it in the browser.
          </p>
          <ul>
            <li><strong>Performance:</strong> Wasm is designed to be fast, efficient, and portable. It's encoded in a compact binary format that can be decoded and executed faster than JavaScript can be parsed.</li>
            <li><strong>Portability:</strong> Run your code across modern browsers. Wasm is a standard and doesn't depend on any specific hardware or operating system.</li>
            <li><strong>Security:</strong> Wasm runs in a sandboxed execution environment, enforcing the browser's same-origin policy and permission policies.</li>
          </ul>
        </div>
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Key Features</h5>
              <ul class="list-unstyled">
                <li><strong>Fast and Efficient</strong></li>
                <li><strong>Safe and Secure</strong></li>
                <li><strong>Language Independent</strong></li>
                <li><strong>Hardware Independent</strong></li>
                <li><strong>Open and Debuggable</strong></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <h2 class="mt-5">Browser Compatibility</h2>
      <p>WebAssembly is supported by all major modern browsers.</p>
      <table class="table table-bordered mt-3">
        <thead>
          <tr>
            <th scope="col">Browser</th>
            <th scope="col">Desktop Version</th>
            <th scope="col">Mobile Version</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Google Chrome</td>
            <td>57+</td>
            <td>57+</td>
          </tr>
          <tr>
            <td>Mozilla Firefox</td>
            <td>52+</td>
            <td>52+</td>
          </tr>
          <tr>
            <td>Microsoft Edge</td>
            <td>16+</td>
            <td>N/A</td>
          </tr>
          <tr>
            <td>Safari</td>
            <td>11+</td>
            <td>11+</td>
          </tr>
          <tr>
            <td>Opera</td>
            <td>44+</td>
            <td>44+</td>
          </tr>
        </tbody>
      </table>

      <h2 class="mt-5">Try It Yourself!</h2>
      <p class="lead">
        Paste your HTML code into the input box below and click the "Minify" button to see the power of Rust and WebAssembly for high-speed minification.
      </p>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="html-input"><strong>Input HTML</strong></label>
            <textarea id="html-input" class="form-control" rows="12" placeholder="<p>  Hello,    world!  </p>"></textarea>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="html-output"><strong>Minified Output</strong></label>
            <textarea id="html-output" class="form-control" rows="12" readonly></textarea>
          </div>
        </div>
      </div>
      <button id="minify-btn" class="btn btn-primary mt-3">Minify HTML</button>

    </div>

    <footer class="bg-dark text-white text-center p-3 mt-5">
      <p>&copy; 2024 WebAssembly Explained</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script type="module">
      console.log('Starting to load WASM module...');
      
      // Import from local files
      import init, { minify } from './minify_html_wasm.js';
      console.log('WASM module imported successfully');

      async function run() {
        console.log('Initializing WASM module...');
        // Initialize the WASM module
        await init();
        console.log('WASM module initialized successfully');

        const minifyBtn = document.getElementById('minify-btn');
        const htmlInput = document.getElementById('html-input');
        const htmlOutput = document.getElementById('html-output');
        const encoder = new TextEncoder();
        const decoder = new TextDecoder();

        console.log('Setting up click event listener...');
        minifyBtn.addEventListener('click', () => {
          console.log('Minify button clicked!');
          const source = htmlInput.value;
          console.log('Input HTML:', source);
          
          if (!source.trim()) {
            console.log('No input provided');
            htmlOutput.value = 'Please enter some HTML to minify.';
            return;
          }
          
          try {
            console.log('Attempting to minify HTML...');
            // Minify the HTML. The second argument is a config object.
            // An empty object uses default settings.
            const encoded = encoder.encode(source);
            console.log('HTML encoded to bytes:', encoded);
            
            const minifiedBytes = minify(encoded, {});
            console.log('Minification completed, result bytes:', minifiedBytes);
            
            const minified = decoder.decode(minifiedBytes);
            console.log('Minified HTML:', minified);
            
            htmlOutput.value = minified;
            console.log('Output updated successfully');
          } catch (e) {
            console.error('Minification error:', e);
            htmlOutput.value = `Error: ${e.message}`;
          }
        });

        // Enable the button now that the WASM module is ready
        minifyBtn.disabled = false;
        minifyBtn.textContent = 'Minify HTML';
        console.log('Button enabled and ready to use');
      }

      // Indicate that the minifier is loading
      const minifyBtn = document.getElementById('minify-btn');
      minifyBtn.disabled = true;
      minifyBtn.textContent = 'Loading Minifier...';
      console.log('Button disabled, starting initialization...');

      run().catch(err => {
        console.error('Failed to load WASM module:', err);
        minifyBtn.textContent = 'Minifier Failed to Load';
        minifyBtn.classList.remove('btn-primary');
        minifyBtn.classList.add('btn-danger');
      });
    </script>
  </body>
</html> 